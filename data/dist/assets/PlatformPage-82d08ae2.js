import{Y as u,a4 as h,j as _,b as e,w as t,G as z,T as F,ae as A,o as g,a8 as N,a9 as v,m as d,e as c,d as i,B as x,C as y,V as T,t as r,z as P,ao as R,n as p,A as J,k as O,F as W,l as U,c as D,g as G,i as j,R as S,E as V,f as k,av as q,H,I as K,S as Y,a2 as Q,a3 as X}from"./index-f4130869.js";import{A as Z}from"./AstrBotConfig-4a1033c3.js";import{W as $}from"./WaitingForRestart-82da020f.js";import{C as ee}from"./ConsoleDisplayer-92b1186c.js";import{I as se}from"./ItemCardGrid-fa18ddda.js";import{u as te}from"./common-5ba6cde7.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-34d28bc5.js";const oe={name:"PlatformPage",components:{AstrBotConfig:Z,WaitingForRestart:$,ConsoleDisplayer:ee,ItemCardGrid:se},data(){return{config_data:{},fetched:!1,metadata:{},showPlatformCfg:!1,newSelectedPlatformName:"",newSelectedPlatformConfig:{},updatingMode:!1,loading:!1,save_message_snack:!1,save_message:"",save_message_success:"success",showConsole:!1,iframeLoading:!0,store:te()}},mounted(){this.getConfig()},methods:{refreshIframe(){this.iframeLoading=!0;const s=document.querySelector("iframe");s.src=s.src+"?t="+new Date().getTime()},getConfig(){u.get("/api/config/get").then(s=>{this.config_data=s.data.data.config,this.fetched=!0,this.metadata=s.data.data.metadata}).catch(s=>{this.showError(s)})},addFromDefaultConfigTmpl(s){var a,n,m;this.newSelectedPlatformName=s[0],this.showPlatformCfg=!0,this.updatingMode=!1,this.newSelectedPlatformConfig=JSON.parse(JSON.stringify(((m=(n=(a=this.metadata.platform_group)==null?void 0:a.metadata)==null?void 0:n.platform)==null?void 0:m.config_template[s[0]])||{}))},editPlatform(s){this.newSelectedPlatformName=s.id,this.newSelectedPlatformConfig=JSON.parse(JSON.stringify(s)),this.updatingMode=!0,this.showPlatformCfg=!0},newPlatform(){this.loading=!0,this.updatingMode?(u.post("/api/config/platform/update",{id:this.newSelectedPlatformName,config:this.newSelectedPlatformConfig}).then(s=>{this.loading=!1,this.showPlatformCfg=!1,this.getConfig(),this.$refs.wfr.check(),this.showSuccess(s.data.message||"更新成功!")}).catch(s=>{var a,n;this.loading=!1,this.showError(((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.message)||s.message)}),this.updatingMode=!1):u.post("/api/config/platform/new",this.newSelectedPlatformConfig).then(s=>{this.loading=!1,this.showPlatformCfg=!1,this.getConfig(),this.showSuccess(s.data.message||"添加成功!")}).catch(s=>{var a,n;this.loading=!1,this.showError(((n=(a=s.response)==null?void 0:a.data)==null?void 0:n.message)||s.message)})},deletePlatform(s){confirm(`确定要删除平台适配器 ${s.id} 吗?`)&&u.post("/api/config/platform/delete",{id:s.id}).then(a=>{this.getConfig(),this.$refs.wfr.check(),this.showSuccess(a.data.message||"删除成功!")}).catch(a=>{var n,m;this.showError(((m=(n=a.response)==null?void 0:n.data)==null?void 0:m.message)||a.message)})},platformStatusChange(s){s.enable=!s.enable,u.post("/api/config/platform/update",{id:s.id,config:s}).then(a=>{this.getConfig(),this.$refs.wfr.check(),this.showSuccess(a.data.message||"状态更新成功!")}).catch(a=>{var n,m;s.enable=!s.enable,this.showError(((m=(n=a.response)==null?void 0:n.data)==null?void 0:m.message)||a.message)})},showSuccess(s){this.save_message=s,this.save_message_success="success",this.save_message_snack=!0},showError(s){this.save_message=s,this.save_message_success="error",this.save_message_snack=!0}}},C=s=>(Q("data-v-ec9230de"),s=s(),X(),s),le={class:"platform-page"},ie={class:"text-h4 font-weight-bold mb-2"},ne=C(()=>d("p",{class:"text-subtitle-1 text-medium-emphasis mb-4"}," 管理机器人的平台适配器，连接到不同的聊天平台 ",-1)),re=C(()=>d("span",{class:"text-h6"},"平台适配器",-1)),de={class:"d-flex align-center mb-2"},me={class:"text-caption text-medium-emphasis"},ce={key:0,class:"d-flex align-center mb-2"},fe=C(()=>d("span",{class:"text-caption text-medium-emphasis"},"Token: ••••••••",-1)),ge={key:1,class:"d-flex align-center"},ue={class:"text-caption text-medium-emphasis text-truncate"},pe=C(()=>d("span",{class:"text-h6"},"平台日志",-1)),he=["src"];function _e(s,a,n,m,o,f){const I=h("item-card-grid"),L=h("ConsoleDisplayer"),B=h("AstrBotConfig"),M=h("WaitingForRestart");return g(),_("div",le,[e(z,{fluid:"",class:"pa-0"},{default:t(()=>[e(N,null,{default:t(()=>[e(v,{cols:"12"},{default:t(()=>[d("h1",ie,[e(c,{size:"x-large",color:"primary",class:"me-2"},{default:t(()=>[i("mdi-connection")]),_:1}),i("平台适配器管理 ")]),ne]),_:1})]),_:1}),e(x,{class:"mb-6",elevation:"2"},{default:t(()=>[e(y,{class:"d-flex align-center py-3 px-4"},{default:t(()=>[e(c,{color:"primary",class:"me-2"},{default:t(()=>[i("mdi-apps")]),_:1}),re,e(T,{color:"info",size:"small",class:"ml-2"},{default:t(()=>{var l;return[i(r(((l=o.config_data.platform)==null?void 0:l.length)||0),1)]}),_:1}),e(P),e(R,null,{activator:t(({props:l})=>[e(p,J({color:"primary","prepend-icon":"mdi-plus",variant:"tonal"},l),{default:t(()=>[i(" 新增适配器 ")]),_:2},1040)]),default:t(()=>[e(O,{"onUpdate:selected":a[0]||(a[0]=l=>f.addFromDefaultConfigTmpl(l))},{default:t(()=>{var l,b,E;return[(g(!0),_(W,null,U(((E=(b=(l=o.metadata.platform_group)==null?void 0:l.metadata)==null?void 0:b.platform)==null?void 0:E.config_template)||{},(Ce,w)=>(g(),D(j,{key:w,rounded:"xl",value:w},{default:t(()=>[e(G,null,{default:t(()=>[i(r(w),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]}),_:1})]),_:1})]),_:1}),e(S),e(V,{class:"px-4 py-3"},{default:t(()=>[e(I,{items:o.config_data.platform||[],"title-field":"id","enabled-field":"enable","empty-icon":"mdi-connection","empty-text":"暂无平台适配器，点击 新增适配器 添加",onToggleEnabled:f.platformStatusChange,onDelete:f.deletePlatform,onEdit:f.editPlatform},{"item-details":t(({item:l})=>[d("div",de,[e(c,{size:"small",color:"grey",class:"me-2"},{default:t(()=>[i("mdi-tag")]),_:1}),d("span",me,[i(" 适配器类型: "),e(T,{size:"x-small",color:"primary",class:"ml-1"},{default:t(()=>[i(r(l.type),1)]),_:2},1024)])]),l.token?(g(),_("div",ce,[e(c,{size:"small",color:"grey",class:"me-2"},{default:t(()=>[i("mdi-key")]),_:1}),fe])):k("",!0),l.description?(g(),_("div",ge,[e(c,{size:"small",color:"grey",class:"me-2"},{default:t(()=>[i("mdi-information-outline")]),_:1}),d("span",ue,r(l.description),1)])):k("",!0)]),_:1},8,["items","onToggleEnabled","onDelete","onEdit"])]),_:1})]),_:1}),e(x,{elevation:"2"},{default:t(()=>[e(y,{class:"d-flex align-center py-3 px-4"},{default:t(()=>[e(c,{color:"primary",class:"me-2"},{default:t(()=>[i("mdi-console-line")]),_:1}),pe,e(P),e(p,{variant:"text",color:"primary",onClick:a[1]||(a[1]=l=>o.showConsole=!o.showConsole)},{default:t(()=>[i(r(o.showConsole?"收起":"展开")+" ",1),e(c,null,{default:t(()=>[i(r(o.showConsole?"mdi-chevron-up":"mdi-chevron-down"),1)]),_:1})]),_:1})]),_:1}),e(S),e(q,null,{default:t(()=>[o.showConsole?(g(),D(V,{key:0,class:"pa-0"},{default:t(()=>[e(L,{style:{"background-color":"#1e1e1e",height:"300px","border-radius":"0"}})]),_:1})):k("",!0)]),_:1})]),_:1})]),_:1}),e(F,{modelValue:o.showPlatformCfg,"onUpdate:modelValue":a[4]||(a[4]=l=>o.showPlatformCfg=l),persistent:""},{default:t(()=>[e(x,null,{default:t(()=>[e(y,{class:"bg-primary text-white py-3"},{default:t(()=>[e(c,{color:"white",class:"me-2"},{default:t(()=>[i(r(o.updatingMode?"mdi-pencil":"mdi-plus"),1)]),_:1}),d("span",null,r(o.updatingMode?"编辑":"新增")+" "+r(o.newSelectedPlatformName)+" 平台适配器",1)]),_:1}),e(V,{class:"py-4"},{default:t(()=>[e(N,null,{default:t(()=>[e(v,{cols:"12",md:"8"},{default:t(()=>{var l;return[e(B,{iterable:o.newSelectedPlatformConfig,metadata:(l=o.metadata.platform_group)==null?void 0:l.metadata,metadataKey:"platform"},null,8,["iterable","metadata"])]}),_:1}),e(v,{cols:"12",md:"4",class:"d-flex flex-column align-end"},{default:t(()=>[e(p,{loading:o.iframeLoading,onClick:f.refreshIframe,variant:"tonal",color:"primary"},{default:t(()=>[e(c,null,{default:t(()=>[i("mdi-refresh")]),_:1}),i(" 刷新 ")]),_:1},8,["loading","onClick"]),H(d("iframe",{src:o.store.getTutorialLink(o.newSelectedPlatformConfig.type),onLoad:a[2]||(a[2]=l=>o.iframeLoading=!1),style:{width:"100%",border:"none","min-height":"400px","margin-top":"10px",flex:"1"}},`
              `,40,he),[[K,!o.iframeLoading]])]),_:1})]),_:1})]),_:1}),e(S),e(Y,{class:"pa-4"},{default:t(()=>[e(P),e(p,{variant:"text",onClick:a[3]||(a[3]=l=>o.showPlatformCfg=!1),disabled:o.loading},{default:t(()=>[i(" 取消 ")]),_:1},8,["disabled"]),e(p,{color:"primary",onClick:f.newPlatform,loading:o.loading},{default:t(()=>[i(" 保存 ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(A,{timeout:3e3,elevation:"24",color:o.save_message_success,modelValue:o.save_message_snack,"onUpdate:modelValue":a[5]||(a[5]=l=>o.save_message_snack=l),location:"top"},{default:t(()=>[i(r(o.save_message),1)]),_:1},8,["color","modelValue"]),e(M,{ref:"wfr"},null,512)])}const be=ae(oe,[["render",_e],["__scopeId","data-v-ec9230de"]]);export{be as default};
