import{_ as g}from"./_plugin-vue_export-helper-c27b6911.js";import{o as n,c as h,w as a,b as s,m as e,e as v,t as l,V,d as u,f as k,E as S,B as T,a2 as y,a3 as $,Y as I,a4 as p,a5 as E,y as D,j as w,a6 as j,R as C,k as G,F as z,l as x,i as Y,g as J,J as W,a7 as f,a8 as R,n as q,U as K,a9 as b}from"./index-f4130869.js";import{u as Q}from"./customizer-b207e117.js";import"./config-aff687d2.js";const X={name:"TotalMessage",props:["stat"],computed:{formattedCount(){var o;const t=(o=this.stat)==null?void 0:o.message_count;return t?t.toLocaleString():"0"}}},U=t=>(y("data-v-31a04cc5"),t=t(),$(),t),Z={class:"d-flex align-start"},tt={class:"icon-wrapper"},et={class:"stat-content"},st=U(()=>e("div",{class:"stat-title"},"消息总数",-1)),at={class:"stat-value-wrapper"},ot={class:"stat-value"},lt=U(()=>e("div",{class:"stat-subtitle"},"所有平台发送的消息总计",-1));function it(t,o,c,_,m,i){return n(),h(T,{elevation:"1",class:"stat-card message-card"},{default:a(()=>[s(S,null,{default:a(()=>[e("div",Z,[e("div",tt,[s(v,{icon:"mdi-message-text-outline",size:"24"})]),e("div",et,[st,e("div",at,[e("h2",ot,l(i.formattedCount),1),c.stat.daily_increase?(n(),h(V,{key:0,class:"trend-chip",size:"x-small",color:"success"},{default:a(()=>[u(" +"+l(c.stat.daily_increase),1)]),_:1})):k("",!0)]),lt])])]),_:1})]),_:1})}const rt=g(X,[["render",it],["__scopeId","data-v-31a04cc5"]]);const nt={name:"OnlinePlatform",props:["stat"]},N=t=>(y("data-v-27201b03"),t=t(),$(),t),ct={class:"d-flex align-start"},dt={class:"icon-wrapper"},_t={class:"stat-content"},mt=N(()=>e("div",{class:"stat-title"},"消息平台",-1)),ht={class:"stat-value-wrapper"},ut={class:"stat-value"},ft=N(()=>e("div",{class:"stat-subtitle"},"已连接的消息平台数量",-1));function pt(t,o,c,_,m,i){return n(),h(T,{elevation:"1",class:"stat-card platform-card"},{default:a(()=>[s(S,null,{default:a(()=>[e("div",ct,[e("div",dt,[s(v,{icon:"mdi-server-network",size:"24"})]),e("div",_t,[mt,e("div",ht,[e("h2",ut,l(c.stat.platform_count||0),1)]),ft])])]),_:1})]),_:1})}const vt=g(nt,[["render",pt],["__scopeId","data-v-27201b03"]]);const gt={name:"RunningTime",props:["stat"],computed:{formattedTime(){var t;return((t=this.stat)==null?void 0:t.running)||"加载中..."}}},B=t=>(y("data-v-6866fe54"),t=t(),$(),t),yt={class:"d-flex align-start"},$t={class:"icon-wrapper"},bt={class:"stat-content"},wt=B(()=>e("div",{class:"stat-title"},"运行时间",-1)),St={class:"stat-value-wrapper"},Tt={class:"stat-value"},Mt=B(()=>e("div",{class:"stat-subtitle"},"AstrBot 运行时间",-1));function Pt(t,o,c,_,m,i){return n(),h(T,{elevation:"1",class:"stat-card uptime-card"},{default:a(()=>[s(S,null,{default:a(()=>[e("div",yt,[e("div",$t,[s(v,{icon:"mdi-clock-outline",size:"24"})]),e("div",bt,[wt,e("div",St,[e("h2",Tt,l(i.formattedTime),1)]),Mt])])]),_:1})]),_:1})}const Ct=g(gt,[["render",Pt],["__scopeId","data-v-6866fe54"]]);const Rt={name:"MemoryUsage",props:["stat"],computed:{memoryPercentage(){return!this.stat.memory||!this.stat.memory.process||!this.stat.memory.system?0:Math.round(this.stat.memory.process/this.stat.memory.system*100)},memoryStatus(){const t=this.memoryPercentage;return t<30?{color:"success",label:"良好"}:t<70?{color:"warning",label:"正常"}:{color:"error",label:"偏高"}}}},L=t=>(y("data-v-0397ad9f"),t=t(),$(),t),It={class:"d-flex align-start"},Vt={class:"icon-wrapper"},kt={class:"stat-content"},zt=L(()=>e("div",{class:"stat-title"},"内存占用",-1)),xt={class:"stat-value-wrapper"},Dt={class:"stat-value"},Ut={class:"memory-unit"},Nt={class:"metrics-container"},Bt={class:"metric-item"},Lt=L(()=>e("div",{class:"metric-label"},"CPU 负载",-1)),At={class:"metric-value"};function Ot(t,o,c,_,m,i){return n(),h(T,{elevation:"1",class:"stat-card memory-card"},{default:a(()=>[s(S,null,{default:a(()=>{var d,r;return[e("div",It,[e("div",Vt,[s(v,{icon:"mdi-memory",size:"24"})]),e("div",kt,[zt,e("div",xt,[e("h2",Dt,[u(l(((d=c.stat.memory)==null?void 0:d.process)||0)+" ",1),e("span",Ut,"MiB / "+l(((r=c.stat.memory)==null?void 0:r.system)||0)+" MiB",1)]),s(V,{color:i.memoryStatus.color,size:"x-small",class:"status-chip"},{default:a(()=>[u(l(i.memoryStatus.label),1)]),_:1},8,["color"])])])]),e("div",Nt,[e("div",Bt,[Lt,e("div",At,l(c.stat.cpu_percent||"0")+"%",1)])])]}),_:1})]),_:1})}const Ft=g(Rt,[["render",Ot],["__scopeId","data-v-0397ad9f"]]);const Ht={name:"MessageStat",props:["stat"],data:()=>({totalMessages:"0",dailyAverage:"0",growthRate:0,loading:!1,selectedTimeRange:{label:"过去 1 天",value:86400},timeRanges:[{label:"过去 1 天",value:86400},{label:"过去 3 天",value:259200},{label:"过去 7 天",value:604800},{label:"过去 30 天",value:2592e3}],chartOptions:{chart:{type:"area",height:400,fontFamily:"inherit",foreColor:"#a1aab2",toolbar:{show:!0,tools:{download:!0,selection:!1,zoom:!0,zoomin:!0,zoomout:!0,pan:!0}},animations:{enabled:!0,easing:"easeinout",speed:800}},colors:["#5e35b1"],fill:{type:"solid",opacity:.3},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},markers:{size:3,strokeWidth:2,hover:{size:5}},tooltip:{theme:Q().uiTheme==="PurpleTheme"?"light":"dark",x:{format:"yyyy-MM-dd HH:mm"},y:{title:{formatter:()=>"消息条数 "}}},xaxis:{type:"datetime",title:{text:"时间"},labels:{formatter:function(t){return new Date(t).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}},tooltip:{enabled:!1}},yaxis:{title:{text:"消息条数"},min:function(t){return t<10?0:Math.floor(t*.8)}},grid:{borderColor:"gray100",row:{colors:["transparent","transparent"],opacity:.2},column:{colors:["transparent","transparent"]},padding:{left:0,right:0}}},chartSeries:[{name:"消息条数",data:[]}],messageTimeSeries:[]}),mounted(){this.fetchMessageSeries()},methods:{formatNumber(t){return new Intl.NumberFormat("zh-CN").format(t)},async fetchMessageSeries(){this.loading=!0;try{const o=(await I.get(`/api/stat/get?offset_sec=${this.selectedTimeRange.value}`)).data.data;o&&o.message_time_series&&(this.messageTimeSeries=o.message_time_series,this.processTimeSeriesData())}catch(t){console.error("获取消息趋势数据失败:",t)}finally{this.loading=!1}},processTimeSeriesData(){this.chartSeries[0].data=this.messageTimeSeries.map(o=>[new Date(o[0]*1e3).getTime(),o[1]]);let t=0;if(this.messageTimeSeries.forEach(o=>{t+=o[1]}),this.totalMessages=this.formatNumber(t),this.messageTimeSeries.length>0){const o=this.selectedTimeRange.value/86400;this.dailyAverage=this.formatNumber(Math.round(t/o))}this.calculateGrowthRate()},calculateGrowthRate(){if(this.messageTimeSeries.length<4){this.growthRate=0;return}const t=Math.floor(this.messageTimeSeries.length/2),o=this.messageTimeSeries.slice(0,t).reduce((_,m)=>_+m[1],0),c=this.messageTimeSeries.slice(t).reduce((_,m)=>_+m[1],0);o>0?this.growthRate=Math.round((c-o)/o*100):this.growthRate=c>0?100:0}}},P=t=>(y("data-v-ec6c8d46"),t=t(),$(),t),Et={class:"chart-header"},jt=P(()=>e("div",null,[e("div",{class:"chart-title"},"消息趋势分析"),e("div",{class:"chart-subtitle"},"跟踪消息数量随时间的变化")],-1)),Gt={class:"d-flex align-center"},Yt={class:"chart-stats"},Jt={class:"stat-box"},Wt=P(()=>e("div",{class:"stat-label"},"总消息数",-1)),qt={class:"stat-number"},Kt={class:"stat-box"},Qt=P(()=>e("div",{class:"stat-label"},"平均每天",-1)),Xt={class:"stat-number"},Zt=P(()=>e("div",{class:"stat-label"},"增长率",-1)),te={class:"stat-number"},ee={class:"chart-container"},se={key:0,class:"loading-overlay"},ae=P(()=>e("div",{class:"loading-text"},"加载中...",-1));function oe(t,o,c,_,m,i){const d=p("apexchart");return n(),h(T,{elevation:"1",class:"chart-card"},{default:a(()=>[s(S,null,{default:a(()=>[e("div",Et,[jt,s(E,{color:"primary",variant:"outlined",density:"compact","hide-details":"",modelValue:t.selectedTimeRange,"onUpdate:modelValue":[o[0]||(o[0]=r=>t.selectedTimeRange=r),i.fetchMessageSeries],items:t.timeRanges,"item-title":"label","item-value":"value",class:"time-select","return-object":"","single-line":""},{selection:a(({item:r})=>[e("div",Gt,[s(v,{start:"",size:"small"},{default:a(()=>[u("mdi-calendar-range")]),_:1}),u(" "+l(r.raw.label),1)])]),_:1},8,["modelValue","items","onUpdate:modelValue"])]),e("div",Yt,[e("div",Jt,[Wt,e("div",qt,l(t.totalMessages),1)]),e("div",Kt,[Qt,e("div",Xt,l(t.dailyAverage),1)]),e("div",{class:D(["stat-box",{"trend-up":t.growthRate>0,"trend-down":t.growthRate<0}])},[Zt,e("div",te,[s(v,{size:"small",icon:t.growthRate>0?"mdi-arrow-up":"mdi-arrow-down"},null,8,["icon"]),u(" "+l(Math.abs(t.growthRate))+"% ",1)])],2)]),e("div",ee,[t.loading?(n(),w("div",se,[s(j,{indeterminate:"",color:"primary"}),ae])):k("",!0),s(d,{type:"area",height:"280",options:t.chartOptions,series:t.chartSeries,ref:"chart"},null,8,["options","series"])])]),_:1})]),_:1})}const le=g(Ht,[["render",oe],["__scopeId","data-v-ec6c8d46"]]);const ie={name:"PlatformStat",props:["stat"],data:()=>({platforms:[]}),computed:{sortedPlatforms(){return[...this.platforms].sort((t,o)=>o.count-t.count)},totalCount(){return this.platforms.reduce((t,o)=>t+o.count,0)},mostActivePlatform(){return this.sortedPlatforms.length>0?this.sortedPlatforms[0].name:"-"},topPlatformPercentage(){return this.totalCount===0||this.sortedPlatforms.length===0?0:Math.round(this.sortedPlatforms[0].count/this.totalCount*100)}},watch:{stat:{handler:function(t){t&&t.platform&&(this.platforms=t.platform)},deep:!0}},methods:{getPercentage(t){return this.totalCount?t/this.totalCount*100:0}}},M=t=>(y("data-v-07c2bc0f"),t=t(),$(),t),re=M(()=>e("div",{class:"platform-header"},[e("div",null,[e("div",{class:"platform-title"},"平台消息统计"),e("div",{class:"platform-subtitle"},"各平台消息数量分布")])],-1)),ne={key:0,class:"platform-list-container"},ce={class:"platform-count"},de={class:"count-value"},_e=M(()=>e("span",{class:"count-label"},"条",-1)),me={class:"platform-stats-summary"},he={class:"platform-stat-item"},ue=M(()=>e("div",{class:"stat-label"},"平台数",-1)),fe={class:"stat-value"},pe={class:"platform-stat-item"},ve=M(()=>e("div",{class:"stat-label"},"最活跃",-1)),ge={class:"stat-value"},ye={class:"platform-stat-item"},$e=M(()=>e("div",{class:"stat-label"},"总消息占比",-1)),be={class:"stat-value"},we={class:"platform-chart"},Se={key:1,class:"no-data"},Te=M(()=>e("div",{class:"no-data-text"},"暂无平台数据",-1));function Me(t,o,c,_,m,i){return n(),h(T,{elevation:"1",class:"platform-stat-card"},{default:a(()=>[s(S,null,{default:a(()=>[re,s(C,{class:"my-3"}),t.platforms.length>0?(n(),w("div",ne,[s(G,{class:"platform-list",density:"compact"},{default:a(()=>[(n(!0),w(z,null,x(i.sortedPlatforms,(d,r)=>(n(),h(Y,{key:r,value:d,class:"platform-item"},{prepend:a(()=>[e("div",{class:D(["platform-rank",{"top-rank":r<3}])},l(r+1),3)]),append:a(()=>[e("div",ce,[e("span",de,l(d.count),1),_e])]),default:a(()=>[s(J,{class:"platform-name"},{default:a(()=>[u(l(d.name),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),e("div",me,[e("div",he,[ue,e("div",fe,l(t.platforms.length),1)]),s(C,{vertical:""}),e("div",pe,[ve,e("div",ge,l(i.mostActivePlatform),1)]),s(C,{vertical:""}),e("div",ye,[$e,e("div",be,l(i.topPlatformPercentage)+"%",1)])]),e("div",we,[(n(!0),w(z,null,x(i.sortedPlatforms.slice(0,5),(d,r)=>(n(),h(W,{key:r,"model-value":i.getPercentage(d.count),height:"8",rounded:"",class:"platform-progress",color:r===0?"primary":r===1?"info":r===2?"success":"grey-lighten-1"},null,8,["model-value","color"]))),128))])])):(n(),w("div",Se,[s(v,{icon:"mdi-information-outline",size:"40",color:"grey-lighten-1"}),Te]))]),_:1})]),_:1})}const Pe=g(ie,[["render",Me],["__scopeId","data-v-07c2bc0f"]]);const Ce={name:"DefaultDashboard",components:{TotalMessage:rt,OnlinePlatform:vt,RunningTime:Ct,MemoryUsage:Ft,MessageStat:le,PlatformStat:Pe},data:()=>({stat:{},noticeTitle:"",noticeContent:"",noticeType:"",lastUpdated:"加载中...",refreshInterval:null,isRefreshing:!1}),mounted(){this.fetchData(),this.fetchNotice(),this.refreshInterval=setInterval(()=>{this.fetchData()},6e4)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{async fetchData(){this.isRefreshing=!0;try{const t=await I.get("/api/stat/get");this.stat=t.data.data,this.lastUpdated=new Date().toLocaleTimeString(),console.log("Dashboard data:",this.stat)}catch(t){console.error("获取数据失败:",t)}finally{this.isRefreshing=!1}},fetchNotice(){I.get("https://api.soulter.top/astrbot-announcement").then(t=>{let o=t.data.data;o["dashboard-notice"]&&(this.noticeTitle=o["dashboard-notice"].title,this.noticeContent=o["dashboard-notice"].content,this.noticeType=o["dashboard-notice"].type)}).catch(t=>{console.error("获取公告失败:",t)})}}},Re=t=>(y("data-v-aef4905b"),t=t(),$(),t),Ie={class:"dashboard-container"},Ve=Re(()=>e("div",{class:"dashboard-header"},[e("h1",{class:"dashboard-title"},"控制台"),e("div",{class:"dashboard-subtitle"},"实时监控和统计数据")],-1)),ke={class:"dashboard-footer"};function ze(t,o,c,_,m,i){const d=p("TotalMessage"),r=p("OnlinePlatform"),A=p("RunningTime"),O=p("MemoryUsage"),F=p("MessageStat"),H=p("PlatformStat");return n(),w("div",Ie,[Ve,s(f,null,{default:a(()=>[t.noticeTitle&&t.noticeContent?(n(),h(R,{key:0,class:"notice-row"},{default:a(()=>[s(K,{type:t.noticeType,text:t.noticeContent,title:t.noticeTitle,closable:"",class:"dashboard-alert",variant:"tonal",border:"start"},null,8,["type","text","title"])]),_:1})):k("",!0)]),_:1}),s(R,{class:"stats-row"},{default:a(()=>[s(b,{cols:"12",md:"3"},{default:a(()=>[s(f,null,{default:a(()=>[s(d,{stat:t.stat},null,8,["stat"])]),_:1})]),_:1}),s(b,{cols:"12",md:"3"},{default:a(()=>[s(f,null,{default:a(()=>[s(r,{stat:t.stat},null,8,["stat"])]),_:1})]),_:1}),s(b,{cols:"12",md:"3"},{default:a(()=>[s(f,null,{default:a(()=>[s(A,{stat:t.stat},null,8,["stat"])]),_:1})]),_:1}),s(b,{cols:"12",md:"3"},{default:a(()=>[s(f,null,{default:a(()=>[s(O,{stat:t.stat},null,8,["stat"])]),_:1})]),_:1})]),_:1}),s(R,{class:"charts-row"},{default:a(()=>[s(b,{cols:"12",lg:"8"},{default:a(()=>[s(f,null,{default:a(()=>[s(F)]),_:1})]),_:1}),s(b,{cols:"12",lg:"4"},{default:a(()=>[s(f,null,{default:a(()=>[s(H,{stat:t.stat},null,8,["stat"])]),_:1})]),_:1})]),_:1}),e("div",ke,[s(V,{size:"small",color:"primary",variant:"flat","prepend-icon":"mdi-refresh"},{default:a(()=>[u(" 最后更新: "+l(t.lastUpdated),1)]),_:1}),s(q,{icon:"mdi-refresh",size:"small",color:"primary",variant:"text",class:"ml-2",onClick:i.fetchData,loading:t.isRefreshing},null,8,["onClick","loading"])])])}const Be=g(Ce,[["render",ze],["__scopeId","data-v-aef4905b"]]);export{Be as default};
