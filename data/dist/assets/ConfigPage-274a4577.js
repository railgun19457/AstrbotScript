import{j as u,b as l,w as t,B as T,c as g,n as c,ae as F,F as p,Y as U,o as s,E,m as b,ah as J,d as m,f as k,l as h,L as w,t as _,K as I,H as S,I as z,N as K,G as $,g as O,ao as D,A as L,e as M,k as A,i as P,M as j,u as W}from"./index-f4130869.js";import{A as C}from"./AstrBotConfig-4a1033c3.js";import{W as B}from"./WaitingForRestart-82da020f.js";import{V as q}from"./index-34d28bc5.js";import"./config-aff687d2.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./common-5ba6cde7.js";const G={key:2,style:{"margin-left":"16px"}},X=b("span",{style:{"font-weight":"1000"}},"再",-1),R={key:0,style:{border:"1px solid var(--v-theme-border)",padding:"8px","margin-bottom":"16px","border-radius":"10px"}},Y={style:{padding:"16px"}},H={key:1},Q={key:0,style:{border:"1px solid var(--v-theme-border)",padding:"8px","margin-bottom":"16px","border-radius":"10px"}},Z=b("div",{style:{"margin-left":"16px","padding-bottom":"16px"}},[b("small",null,[m("不了解配置？请见 "),b("a",{href:"https://astrbot.app/"},"官方文档"),m(" 或 "),b("a",{href:"https://qm.qq.com/cgi-bin/qm/qr?k=EYGsuUTfe00_iOu9JTXS7_TEpMkXOvwv&jump_from=webapi&authKey=uUEMKCROfsseS+8IzqPjzV3y1tzy4AkykwTib2jNkOFdzezF9s9XknqnIaf3CDft"},"加群询问"),m("。")])],-1),x={name:"ConfigPage",components:{AstrBotConfig:C,VueMonacoEditor:q,WaitingForRestart:B},watch:{config_data_str:function(o){this.config_data_has_changed=!0}},data(){return{config_data_has_changed:!1,config_data_str:"",config_data:{config:{}},fetched:!1,metadata:{},provider_config_tmpl:{},adapter_config_tmpl:{},save_message_snack:!1,save_message:"",save_message_success:"",namespace:"",tab:0,editorTab:0,config_template_tab:0}},mounted(){this.getConfig()},methods:{getConfig(){U.get("/api/config/get").then(o=>{this.config_data=o.data.data.config,this.fetched=!0,this.metadata=o.data.data.metadata,this.provider_config_tmpl=o.data.data.provider_config_tmpl,this.adapter_config_tmpl=o.data.data.adapter_config_tmpl}).catch(o=>{save_message=o,save_message_snack=!0,save_message_success="error"})},updateConfig(){this.fetched&&U.post("/api/config/astrbot/update",this.config_data).then(o=>{o.data.status==="ok"?(this.save_message=o.data.message,this.save_message_snack=!0,this.save_message_success="success",this.$refs.wfr.check()):(this.save_message=o.data.message,this.save_message_snack=!0,this.save_message_success="error")}).catch(o=>{this.save_message=o,this.save_message_snack=!0,this.save_message_success="error"})},configToString(){this.config_data_str=JSON.stringify(this.config_data,null,2),this.config_data_has_changed=!1},applyStrConfig(){try{this.config_data=JSON.parse(this.config_data_str),this.config_data_has_changed=!1,this.save_message_success="success",this.save_message="配置成功应用。如要保存，需再点击右下角保存按钮。",this.save_message_snack=!0}catch{this.save_message_success="error",this.save_message="配置未应用，Json 格式错误。",this.save_message_snack=!0}},addFromDefaultConfigTmpl(o,a,e){console.log(o);let i=this.metadata[a].metadata[e].config_template[o],r=JSON.parse(JSON.stringify(i));this.config_data[e].push(r),this.config_template_tab=this.config_data[e].length-1},deleteItem(o,a){console.log(o,a);let e=[];for(let i=0;i<this.config_data[o].length;i++)i!==a&&e.push(this.config_data[o][i]);this.config_data[o]=e,this.config_template_tab>0&&(this.config_template_tab-=1)}}},ra=Object.assign(x,{setup(o){return(a,e)=>(s(),u(p,null,[l(T,{style:{"margin-bottom":"16px"}},{default:t(()=>[l(E,{style:{padding:"0"}},{default:t(()=>[b("div",null,[l(J,{variant:"outlined",divided:""},{default:t(()=>[l(c,{icon:"mdi-text-box-edit-outline",style:{width:"80px"},color:a.editorTab===0?"primary":"",onClick:e[0]||(e[0]=i=>a.editorTab=0)},null,8,["color"]),l(c,{icon:"mdi-code-json",style:{width:"80px"},color:a.editorTab===1?"primary":"",onClick:e[1]||(e[1]=i=>{a.configToString(),a.editorTab=1})},null,8,["color"])]),_:1}),a.editorTab===1?(s(),g(c,{key:0,style:{"margin-left":"16px"},size:"small",onClick:e[2]||(e[2]=i=>a.configToString())},{default:t(()=>[m("回到更改前的代码")]),_:1})):k("",!0),a.editorTab===1&&a.config_data_has_changed?(s(),g(c,{key:1,style:{"margin-left":"16px"},size:"small",onClick:e[3]||(e[3]=i=>a.applyStrConfig())},{default:t(()=>[m("应用此配置")]),_:1})):k("",!0),a.editorTab===1?(s(),u("small",G,[m("💡 `应用此配置` 将配置暂存并应用到可视化。如要保存，需"),X,m("点击右下角保存按钮。")])):k("",!0)])]),_:1})]),_:1}),a.editorTab===0?(s(),g(T,{key:0},{default:t(()=>[l(I,{modelValue:a.tab,"onUpdate:modelValue":e[4]||(e[4]=i=>a.tab=i),"align-tabs":"left",color:"deep-purple-accent-4"},{default:t(()=>[(s(!0),u(p,null,h(a.metadata,(i,r,y)=>(s(),g(w,{key:y,value:y,style:{"font-weight":"1000","font-size":"15px"}},{default:t(()=>[m(_(a.metadata[r].name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),l(j,{modelValue:a.tab,"onUpdate:modelValue":e[7]||(e[7]=i=>a.tab=i)},{default:t(()=>[(s(!0),u(p,null,h(a.metadata,(i,r,y)=>S((s(),g(K,{key:y},{default:t(()=>[l($,{fluid:""},{default:t(()=>[(s(!0),u(p,null,h(a.metadata[r].metadata,(aa,d,ea)=>{var N;return s(),u("div",null,[(N=a.metadata[r].metadata[d])!=null&&N.config_template?S((s(),u("div",R,[l(O,{style:{"font-weight":"bold"}},{default:t(()=>[m(_(a.metadata[r].metadata[d].description)+" ("+_(d)+") ",1)]),_:2},1024),l(I,{style:{"margin-top":"16px"},"align-tabs":"left",color:"deep-purple-accent-4",modelValue:a.config_template_tab,"onUpdate:modelValue":e[5]||(e[5]=f=>a.config_template_tab=f)},{default:t(()=>{var f;return[(f=a.metadata[r].metadata[d])!=null&&f.tmpl_display_title?(s(!0),u(p,{key:0},h(a.config_data[d],(n,v)=>(s(),g(w,{key:v,value:v},{default:t(()=>{var V;return[m(_(n[(V=a.metadata[r].metadata[d])==null?void 0:V.tmpl_display_title]),1)]}),_:2},1032,["value"]))),128)):(s(!0),u(p,{key:1},h(a.config_data[d],(n,v)=>(s(),g(w,{key:v+"_",value:v},{default:t(()=>[m(_(n.id)+"("+_(n.type)+") ",1)]),_:2},1032,["value"]))),128)),l(D,null,{activator:t(({props:n})=>[l(c,L({variant:"plain",size:"large"},n),{default:t(()=>[l(M,null,{default:t(()=>[m("mdi-plus")]),_:1})]),_:2},1040)]),default:t(()=>[l(A,{"onUpdate:selected":n=>a.addFromDefaultConfigTmpl(n,r,d)},{default:t(()=>{var n;return[(s(!0),u(p,null,h((n=a.metadata[r].metadata[d])==null?void 0:n.config_template,(v,V)=>(s(),g(P,{key:V,value:V},{default:t(()=>[l(O,null,{default:t(()=>[m(_(V),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]}),_:2},1032,["onUpdate:selected"])]),_:2},1024)]}),_:2},1032,["modelValue"]),l(j,{modelValue:a.config_template_tab,"onUpdate:modelValue":e[6]||(e[6]=f=>a.config_template_tab=f)},{default:t(()=>[(s(!0),u(p,null,h(a.config_data[d],(f,n)=>S((s(),g(K,{key:n,value:n},{default:t(()=>[b("div",Y,[l(c,{variant:"tonal",rounded:"xl",color:"error",onClick:v=>a.deleteItem(d,n)},{default:t(()=>[m(" 删除这项 ")]),_:2},1032,["onClick"]),l(C,{metadata:a.metadata[r].metadata,iterable:f,metadataKey:d},null,8,["metadata","iterable","metadataKey"])])]),_:2},1032,["value"])),[[z,a.config_template_tab===n]])),128))]),_:2},1032,["modelValue"])],512)),[[z,d!=="platform"&&d!=="provider"]]):(s(),u("div",H,[a.metadata[r].metadata[d].type=="object"?(s(),u("div",Q,[l(C,{metadata:a.metadata[r].metadata,iterable:a.config_data[d],metadataKey:d},null,8,["metadata","iterable","metadataKey"])])):(s(),g(C,{key:1,metadata:a.metadata[r].metadata,iterable:a.config_data,metadataKey:d},null,8,["metadata","iterable","metadataKey"]))]))])}),256))]),_:2},1024)]),_:2},1024)),[[z,y==a.tab]])),128)),Z]),_:1},8,["modelValue"])]),_:1})):(s(),g(T,{key:1,style:{"background-color":"#1e1e1e"}},{default:t(()=>[l(W(q),{theme:"vs-dark",language:"json",height:"80vh",style:{"padding-top":"16px","padding-bottom":"16px"},value:a.config_data_str,"onUpdate:value":e[8]||(e[8]=i=>a.config_data_str=i)},null,8,["value"])]),_:1})),l(c,{icon:"mdi-content-save",size:"x-large",style:{position:"fixed",right:"52px",bottom:"52px"},color:"darkprimary",onClick:a.updateConfig},null,8,["onClick"]),l(F,{timeout:3e3,elevation:"24",color:a.save_message_success,modelValue:a.save_message_snack,"onUpdate:modelValue":e[9]||(e[9]=i=>a.save_message_snack=i)},{default:t(()=>[m(_(a.save_message),1)]),_:1},8,["color","modelValue"]),l(B,{ref:"wfr"},null,512)],64))}});export{ra as default};
